#!/bin/sh

# The production directory
TARGET="/srv/www/project"

# A temporary directory for deployment
TEMP="/srv/tmp/project"

# The Git repo
REPO="/srv/git/project.git"

# Deploy the content to the temporary directory
mkdir -p $TARGET
git --work-tree=$TARGET --git-dir=$REPO checkout -f
cd $TARGET

# Build and start the application
if test -f "docker-compose.yml"; then
    docker-compose down --remove-orphans && \
    docker-compose build && \
    docker-compose up -d && \
    docker-compose logs
fi 
